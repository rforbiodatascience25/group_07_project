---
title: "data_cleaning"
format: html
edtiro: visual
---

# Libraries & Functions

```{r}
library("tidyverse")
library("dplyr")
library("janitor")

source("../R/99_proj_func.R")
```

# General cleaning guidelines for this project

-   Subsetting columns that we're not going to use for this project.

-   Cleaning column names with the `janitor` library.

-   Skip over the first and/or second lines of the excel files. (This is done on `data_loading.qmd` to have the appropiate data structure from the start).

-   Drop NAs (Check with the NA_check function)

# Cleaning table 2 + 3

MAKE THESE COMMENTS LOOK NICER

Eliminate standard deviation part.

Keep things on the right too (peptides, etc).

Keep only logLFQ.

Separate data into different tables (isoalted cells, brain regions and cerebellum development)

Eliminate (PEP column?) and Mol. weight.

Rename columns to have standard names

```{r}
#| echo: false

#reading the tsv file
dirty_2 <-read_tsv(file = "../data/dirty_data/supp_2.tsv")

#checking
View(dirty_2)

#Want to remove all SD columns (from column nr 21-38), but keep all else
clean_2 <- dirty_2 |> 
  select(1:20, 39:40, 42:43)

#3 remaining column headers; Isolated cells, Brain regions, cerebellum development

#Isolated cells table
clean_2_isolated_cells <- clean_2 |> 
  select(1:6, 21:24)

#Brain region table
clean_2_brain_regions <- clean_2 |> 
  select(1:2, 7:17, 21:24)
  
#Cerebellum dev table
clean_2_cerebellum_development <- clean_2 |>
  select(1:2, 18:20, 21:24)



# Cleaning table 3

#MAKE THESE COMMENTS LOOK NICER

#Before removing NaN values, the data has: 19,501 entries After removing NaN values, the data has: 11,062 entries

#Rename columns so they have more standard names

#| echo: false

dirty_3 <- read_tsv(file = "../data/dirty_data/supp_3.tsv")

#Transforming NaNs into NAs to drop them and cleaning column names
clean_3 <- drop_na(
  mutate(
    clean_names(dirty_3),
    across(everything(), 
    ~replace(., is.nan(.), NA))
  )
)  
```

# Cleaning table 5

```{r}
#| echo: false

dirty_5 <- read_tsv(file = "../data/dirty_data/supp_5.tsv")

#Dropping duplicate gene_names (keeping the first one)

clean_5 <- dirty_5 |> 
  select(-contains("young"), -PEP, - `Mol. weight [kDa]`, -`Protein IDs`, -`Majority protein IDs`) |> 
  clean_names() |> 
  distinct(gene_names, .keep_all = T) 

NA_check(clean_5) #0.32% of the values are NAs. So dropping NAs won't affect our results. 

clean_5 <- clean_5 |> 
  drop_na()

#This table is with the separated gene names on each column. 
#"Tidy data" but would mess up our numeric operations. Just in case we need it. 
clean_5_separate_gene_names <- clean_5 |> 
  separate_longer_delim(cols = gene_names, delim = ";")


```

# Cleaning table 17

```{r}
dirty_17 <- read_tsv(file = "../data/dirty_data/supp_17.tsv")

clean_17 <- dirty_17 |> 
  clean_names() 

NA_check(clean_17) #17.55% of the data is NAs
#BUT if an NA check is conducted on the subset that will be used afterwards for the analysis, it doesn't have any NAs!

NA_check(clean_17 |> 
           select(14:23)) #0% NAs!!

#So for this specific table it was decided that the NA drop can be skipped, since it would only hurt the analysis. 

```

# Writing clean data to tables

Table 2 was separated in different ones to make data analysis easier, as not all data is necessary for all further plotting.

```{r}
#Create directory in case it doesn't exist already 
dir.create("../data/clean_data", recursive = TRUE, showWarnings = FALSE)

write_tsv(clean_1, "../data/clean_data/clean_1.tsv")

write_tsv(clean_2, "../data/clean_data/clean_2.tsv")

write_tsv(clean_2_brain_regions, "../data/clean_data/clean_2_brain_regions.tsv")

write_tsv(clean_2_cerebellum_development, "../data/clean_data/
          clean_2_cerebellum_development.tsv")

write_tsv(clean_2_isolated_cells, "../data/clean_data/clean_2_isolated_cells.tsv")

write_tsv(clean_3, "../data/clean_data/clean_3.tsv")

write_tsv(clean_5, "../data/clean_data/clean_5.tsv")

write_tsv(clean_5_separate_gene_names, "../data/clean_data/clean_5_separate_gene_names.tsv")

write_tsv(clean_17, "../data/clean_data/clean_17.tsv")
```
